# TeslaCenter AI Coding Agent Instructions

This document provides guidance for AI coding agents to effectively contribute to the TeslaCenter project.

## Project Overview

TeslaCenter is a React-based web application designed for Tesla's in-car browser. It provides a customizable dashboard of web apps and links for easy access while in the car. The project uses Firebase for backend services, including Realtime Database and Cloud Functions.

## Key Technologies

- **Frontend:** React, TypeScript, React Bootstrap
- **Backend:** Firebase (Realtime Database, Cloud Functions)
- **Build Tool:** Create React App (`react-scripts`)
- **Deployment:** Firebase Hosting

## Architecture

### Frontend (`src/`)

- **`App.tsx`**: The main application component. It manages the state of the app list, user interactions, and modals. It also handles the logic for fullscreen mode and QR code sessions for adding apps.
- **`index.tsx`**: The entry point of the React application.
- **`components/`**: Contains reusable React components.
  - `AppItem.tsx`: Renders a single app in the grid.
  - `AddAppQR.tsx`: A component that allows adding apps via a QR code, useful for sending links from a phone to the car.
- **`utils/`**: Utility functions.
  - `firebase.ts`: Initializes Firebase and exports the database instance.
  - `location.ts`: Determines the user's region to provide default app lists.
- **`public/`**: Static assets, including `index.html` and `default-apps.json`.
- **`image-manifest.js`**: This file is generated by `scripts/generate-image-manifest.js` and contains a list of background images.

### Backend (`functions/`)

- **`index.js`**: Contains a single Cloud Function, `cleanupQrSessions`, which runs on a schedule to remove expired QR code sessions from the Realtime Database.

### Firebase (`firebase.json`, `database.rules.json`)

- **`firebase.json`**: Configures Firebase Hosting to serve the `build` directory and rewrites all URLs to `index.html` to support client-side routing.
- **`database.rules.json`**: Defines the security rules for the Firebase Realtime Database. It has rules for `qr_sessions` and `fullscreen_sessions`.

## Developer Workflows

### Getting Started

1.  Install dependencies: `npm install`
2.  Run the development server: `npm start`

This will start the app in development mode, available at `http://localhost:3000`.

### Building for Production

- To create a production build for Firebase deployment, run: `npm run build:firebase`
- This command creates a production-ready build in the `build` directory.

### Deployment

- Deployment is handled via Firebase CLI.
- The command `npm run deploy:firebase` will first build the project and then deploy it to Firebase Hosting.

## Project Conventions

- **State Management:** The primary app state (the list of apps) is managed in the `App` component using React hooks (`useState`, `useEffect`). State is persisted to `localStorage` to be available across sessions.
- **Cross-Tab Sync:** The app uses a `BroadcastChannel` (`teslacenter_sync`) to synchronize the app list across different browser tabs in real-time. This is important for the fullscreen mode, which opens in a new tab.
- **Default Apps:** On first load or when the user changes their region, a default set of apps is loaded from `public/default-apps.json`.
- **Adding Apps via QR Code:** The `AddAppQR` component facilitates adding apps by scanning a QR code. This creates a temporary session in the Firebase Realtime Database under `qr_sessions`. The main app listens for changes to this session to add the new app.
- **Fullscreen Mode:** Fullscreen mode is initiated by opening a new tab with a special URL. The state of the apps is passed to the new tab via a `fullscreen_session` in the Firebase Realtime Database.

## How to Contribute

- When adding new components, place them in the `src/components` directory.
- For new utility functions, add them to the `src/utils` directory.
- If you add new background images, run `node scripts/generate-image-manifest.js` to update the image manifest.
- When modifying the database structure, be sure to update the security rules in `database.rules.json`.
